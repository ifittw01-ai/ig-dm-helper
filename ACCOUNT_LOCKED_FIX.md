# 🔒 账号被锁定 / 需要验证 - 解决指南

## ⚠️ 错误信息

```
Maximum number of redirects exceeded
获取用户 ID 失败: Maximum number of redirects exceeded
```

---

## 🔍 这个错误的含义

这**不是应用程序的 bug**，而是 **Instagram 的安全机制**：

### 为什么会发生？

1. **账号需要验证（Challenge Required）** ⭐ 最常见
   - Instagram 检测到异常登录
   - 要求完成安全验证
   - 不断重定向到验证页面

2. **短时间内操作太多**
   - 发送太多请求
   - 触发了速率限制

3. **Session 失效**
   - Cookie 过期
   - 需要重新登录

4. **IP 地址被标记**
   - 使用了代理或 VPN
   - IP 信誉不良

---

## ✅ 解决方案

### 方案 1：在浏览器完成验证 ⭐ 最有效

1. **打开浏览器，访问 Instagram**
   ```
   https://www.instagram.com
   ```

2. **登录您的账号**
   - 使用应用中使用的账号
   - 输入用户名和密码

3. **完成安全验证**
   
   可能的验证方式：
   - ✅ 输入手机验证码
   - ✅ 确认是您本人登录
   - ✅ 验证登录位置
   - ✅ 回答安全问题
   - ✅ 识别图片

4. **确认可以正常使用**
   - 浏览几个页面
   - 确认没有弹窗
   - 确认账号状态正常

5. **返回应用重试**
   - 关闭应用
   - 重新启动
   - 重新登录

---

### 方案 2：等待 24 小时 ⏰

如果账号被临时限制：

1. **停止使用工具**
   - 等待 24-48 小时

2. **期间正常使用 Instagram**
   - 在手机 App 正常浏览
   - 发几个帖子/Story
   - 和朋友互动

3. **让账号恢复正常**
   - Instagram 会解除限制

---

### 方案 3：更换账号 👤

如果主账号被锁：

1. **使用测试账号**
   - 创建新的 Instagram 账号
   - 用于测试功能

2. **降低使用频率**
   - 每天使用不超过 2-3 次
   - 每次间隔至少 1 小时

---

### 方案 4：更换网络环境 🌐

1. **更换 IP 地址**
   - 重启路由器
   - 使用手机热点
   - 更换网络供应商

2. **不使用代理/VPN**
   - 使用真实的本地 IP
   - 避免共享 IP

---

## 🛡️ 预防措施

### 1. 控制使用频率

**建议限制：**
```
每小时：
- 发送私信：< 30 条
- 抓取粉丝：< 2000 个
- API 请求：< 200 次

每天：
- 发送私信：< 100 条
- 抓取粉丝：< 5000 个
- 登录次数：< 5 次
```

---

### 2. 增加延迟时间

在 `main.js` 中调整：

```javascript
// 找到这个函数并修改
function randomDelay() {
    // 从 30-60 秒改为 60-120 秒
    return 60000 + Math.random() * 60000;
}
```

---

### 3. 使用成熟的账号

- ✅ 注册时间 > 3 个月
- ✅ 有真实的粉丝和内容
- ✅ 完整的个人资料
- ✅ 绑定手机号和邮箱
- ❌ 不要用新注册的空账号

---

### 4. 模拟真实行为

- 不要 24/7 运行
- 每天固定时间使用
- 使用后正常浏览 Instagram
- 不要只发送不接收

---

## 🔧 技术改进（已完成）

### 已添加的保护：

1. **限制重定向次数**
   ```javascript
   maxRedirects: 3  // 防止无限循环
   ```

2. **详细错误提示**
   ```javascript
   if (error.message.includes('Maximum number of redirects')) {
       console.error('⚠️ 账号需要验证！');
   }
   ```

3. **Challenge 检测**
   ```javascript
   if (error.response?.data?.message === 'challenge_required') {
       console.error('⚠️ 请在浏览器完成验证');
   }
   ```

---

## 📋 检查清单

### 如何判断账号状态？

**✅ 账号正常：**
- 能在浏览器正常登录
- 没有弹出验证窗口
- 可以正常浏览和互动

**⚠️ 需要验证：**
- 登录时要求验证身份
- 弹出"是您本人吗？"
- 要求输入验证码

**❌ 账号被封：**
- 完全无法登录
- 提示"账号已被禁用"
- 收到 Instagram 邮件通知

---

## 🔄 完整恢复步骤

### 步骤 1：在浏览器验证账号

```
1. 打开 https://www.instagram.com
2. 登录账号
3. 完成所有验证步骤
4. 浏览几个页面确认正常
```

### 步骤 2：清除应用数据

```powershell
# 删除数据库文件（Windows）
del %APPDATA%\ig-dm-helper\igdm.db
```

### 步骤 3：重新启动应用

```powershell
npm start
```

### 步骤 4：重新登录

```
1. 输入用户名和密码
2. 点击「登入」
3. 等待登录成功
```

### 步骤 5：测试功能

```
使用小范围测试：
- 抓取 10 个粉丝
- 如果成功，账号已恢复
- 如果失败，等待 24 小时再试
```

---

## 🚨 警告标志

如果看到这些，立即停止：

1. **连续多次重定向错误**
   ```
   Maximum number of redirects exceeded
   ```
   → 停止使用 24 小时

2. **401 Unauthorized**
   ```
   Request failed with status code 401
   ```
   → 重新登录

3. **429 Too Many Requests**
   ```
   Request failed with status code 429
   ```
   → 降低使用频率

4. **Challenge Required**
   ```
   challenge_required
   ```
   → 在浏览器完成验证

---

## 💡 最佳实践

### DO ✅

- 使用成熟的账号
- 控制使用频率
- 增加随机延迟
- 定期在浏览器正常使用
- 绑定手机和邮箱
- 使用真实 IP

### DON'T ❌

- 新账号立即使用工具
- 24/7 不间断运行
- 短时间大量操作
- 使用代理/VPN
- 多个账号共用 IP
- 发送垃圾内容

---

## 📞 仍然无法解决？

### 联系支持：

提供以下信息：

1. **错误详情**
   ```
   完整的错误信息
   出错时在做什么
   ```

2. **账号状态**
   ```
   能否在浏览器登录？
   是否需要验证？
   账号注册多久？
   ```

3. **使用情况**
   ```
   每天使用几次？
   发送多少消息？
   抓取多少粉丝？
   ```

---

## 🎯 总结

**这个错误的原因：** Instagram 的安全机制

**解决方法：** 在浏览器完成账号验证

**预防方法：** 控制使用频率，模拟真实行为

**关键：** 耐心等待，不要急于求成

---

**记住：Instagram 的限制是为了防止滥用，请负责任地使用工具！** 🙏

