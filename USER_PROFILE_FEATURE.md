# 👤 群发时显示用户资料功能

## ✨ 新功能说明

在批量发送 DM 时，**自动显示每个目标用户的 Instagram 个人资料**，让您可以：

- ✅ 确认是否是正确的目标用户
- ✅ 查看用户的粉丝数、关注数、帖子数
- ✅ 查看用户简介和全名
- ✅ 了解是否为私密账号/已验证账号
- ✅ 决定是否要发送给该用户

---

## 📸 效果展示

### 发送前显示用户资料

```
[1/10] 目标用户: @instagram

正在获取用户信息...

╔══════════════════════════════════════════════════════════╗
║                    用户资料                              ║
╚══════════════════════════════════════════════════════════╝

👤 用户名: @instagram
📝 全名: Instagram
💬 简介: Discover what's next on Instagram 📷
👥 粉丝: 661.2M
➕ 关注: 76
📷 帖子: 7450
🔓 公开账号
✅ 已验证

────────────────────────────────────────────────────────────

是否发送消息给 @instagram? (y/n/s=跳过/q=停止): 
```

### 您的选择

| 输入 | 说明 | 效果 |
|------|------|------|
| `y` / `yes` / `是` / 回车 | 确认发送 | ✅ 发送消息给该用户 |
| `n` / `no` / `否` | 不发送 | ⏭️ 跳过该用户，继续下一个 |
| `s` / `skip` / `跳过` | 跳过 | ⏭️ 跳过该用户，继续下一个 |
| `q` / `quit` / `停止` | 停止 | 🛑 停止所有发送 |

---

## 🚀 使用方法

### 方法 1：使用演示脚本（推荐）

```bash
node demo-smart-batch-dm.js
```

运行后会询问：

```
是否在发送前显示用户资料? (y/n，默认 y): 
```

- 输入 `y` 或直接回车：每个用户发送前都会显示资料
- 输入 `n`：直接发送，不显示资料（自动模式）

### 方法 2：在代码中使用

#### 显示用户资料（默认）

```javascript
const InstagramAPI = require('./src/instagram-api');
const SmartBatchDM = require('./src/smart-batch-dm');

const igAPI = new InstagramAPI();
await igAPI.login('username', 'password');

const batchDM = new SmartBatchDM(igAPI);

await batchDM.sendBatch(
    ['user1', 'user2', 'user3'],
    'Hello!',
    {
        delay: 5000,
        showProfile: true // ✅ 显示用户资料
    }
);
```

#### 不显示用户资料（自动模式）

```javascript
await batchDM.sendBatch(
    ['user1', 'user2', 'user3'],
    'Hello!',
    {
        delay: 5000,
        showProfile: false // ❌ 不显示，直接发送
    }
);
```

---

## 💡 使用场景

### 场景 1：精准营销

```
目标：向潜在客户发送消息

✅ 显示资料后可以：
- 确认粉丝数是否符合目标（如 > 10K）
- 查看简介判断是否相关
- 避免发送给竞争对手
- 跳过私密账号
```

### 场景 2：合作邀请

```
目标：邀请 KOL 合作

✅ 显示资料后可以：
- 确认是否为已验证账号
- 查看粉丝数是否达标
- 查看简介是否匹配领域
- 确认是正确的 KOL
```

### 场景 3：客户回访

```
目标：向老客户发送消息

✅ 显示资料后可以：
- 确认是否为老客户
- 查看最近活跃情况
- 个性化消息内容
```

---

## 📊 完整流程示例

### 示例：发送给 3 个用户

```bash
node demo-smart-batch-dm.js
```

**步骤 1: 登入**
```
请输入您的 Instagram 用户名: my_account
请输入密码: ********

🔐 正在登入...
✅ 登入成功！
```

**步骤 2: 输入目标用户**
```
请输入目标用户名，每行一个，输入空行结束：

用户 1: instagram
用户 2: cristiano
用户 3: (回车结束)

✓ 已添加 2 个用户
```

**步骤 3: 输入消息**
```
消息内容: Hello! 这是一条测试消息。

✓ 消息设置完成
```

**步骤 3.5: 选择是否显示资料**
```
是否在发送前显示用户资料? (y/n，默认 y): y

✓ 将在发送前显示每个用户的资料
```

**步骤 4: 确认**
```
📊 发送预览

目标用户 (2 个):
  1. @instagram
  2. @cristiano

消息内容: Hello! 这是一条测试消息。

确认发送？(y/n): y
```

**步骤 5: 开始发送**

```
╔════════════════════════════════════════╗
║   智能批量发送 DM                      ║
╚════════════════════════════════════════╝

目标用户数: 2
消息内容: Hello! 这是一条测试消息。
发送间隔: 5 秒

开始发送...

════════════════════════════════════════════════════════════

[1/2] 目标用户: @instagram

正在获取用户信息...

╔══════════════════════════════════════════════════════════╗
║                    用户资料                              ║
╚══════════════════════════════════════════════════════════╝

👤 用户名: @instagram
📝 全名: Instagram
💬 简介: Discover what's next on Instagram 📷
👥 粉丝: 661.2M
➕ 关注: 76
📷 帖子: 7450
🔓 公开账号
✅ 已验证

────────────────────────────────────────────────────────────

是否发送消息给 @instagram? (y/n/s=跳过/q=停止): y

✓ 准备发送...

✅ 成功发送给 @instagram

等待 5 秒...

[2/2] 目标用户: @cristiano

正在获取用户信息...

╔══════════════════════════════════════════════════════════╗
║                    用户资料                              ║
╚══════════════════════════════════════════════════════════╝

👤 用户名: @cristiano
📝 全名: Cristiano Ronaldo
💬 简介: 🇵🇹👨‍👩‍👧‍👦
       Managed by @gestifute
👥 粉丝: 634.5M
➕ 关注: 575
📷 帖子: 3563
🔓 公开账号
✅ 已验证

────────────────────────────────────────────────────────────

是否发送消息给 @cristiano? (y/n/s=跳过/q=停止): n

✓ 跳过该用户...

⏭️  已跳过 @cristiano

════════════════════════════════════════════════════════════
📊 发送报告
════════════════════════════════════════════════════════════

总计: 2 个用户
✅ 成功: 1 个
⏭️  跳过: 1 个

成功发送的用户:
  ✅ @instagram

跳过的用户:
  ⏭️  @cristiano (user_manually_skipped)

════════════════════════════════════════════════════════════

✓ 报告已保存到: batch-dm-report.json

🎉 完成！
```

---

## 🎯 显示的信息

### 用户资料包含：

| 信息 | 说明 | 示例 |
|------|------|------|
| 👤 用户名 | Instagram 用户名 | `@instagram` |
| 📝 全名 | 显示名称 | `Instagram` |
| 💬 简介 | 个人简介 | `Discover what's next...` |
| 👥 粉丝 | 粉丝数量 | `661.2M` (格式化显示) |
| ➕ 关注 | 关注数量 | `76` |
| 📷 帖子 | 帖子数量 | `7450` |
| 🔓/🔒 | 账号类型 | 公开账号 / 私密账号 |
| ✅ | 验证状态 | 已验证（如果有）|

### 数字格式化

- `< 1000`: 直接显示（如 `999`）
- `1K - 999K`: 显示 K（如 `50.5K`）
- `≥ 1M`: 显示 M（如 `661.2M`）

---

## ⚙️ 配置选项

```javascript
await batchDM.sendBatch(users, message, {
    // 每条消息之间的延迟（毫秒）
    delay: 5000,
    
    // 是否显示用户资料
    showProfile: true, // true=显示, false=不显示
    
    // 进度回调
    onProgress: (progress) => {
        console.log(`进度: ${progress.current}/${progress.total}`);
    }
});
```

---

## 💡 使用技巧

### 1. 快速确认发送

```
是否发送消息给 @username? (y/n/s=跳过/q=停止): 

输入: (直接回车)  ← 默认发送，最快
```

### 2. 批量跳过

看到不合适的用户时：

```
是否发送消息给 @username? (y/n/s=跳过/q=停止): s

✓ 跳过该用户...
```

### 3. 紧急停止

如果需要立即停止：

```
是否发送消息给 @username? (y/n/s=跳过/q=停止): q

✓ 停止发送...
```

### 4. 根据资料决定

```
粉丝数太少？输入 n 跳过
私密账号？输入 n 跳过
简介不相关？输入 n 跳过
完全匹配？输入 y 或直接回车
```

---

## 🔧 自动模式 vs 手动模式

### 手动模式（showProfile: true）

**优点：**
- ✅ 可以逐个确认用户
- ✅ 避免发送给错误的用户
- ✅ 可以查看详细资料
- ✅ 灵活控制

**适用场景：**
- 重要的营销活动
- 合作邀请
- 需要精准筛选

### 自动模式（showProfile: false）

**优点：**
- ✅ 完全自动化
- ✅ 快速发送
- ✅ 无需人工干预

**适用场景：**
- 已经筛选好的用户列表
- 批量通知
- 定期群发

---

## 📚 API 参考

### showUserProfile(username)

显示用户资料

```javascript
await batchDM.showUserProfile('instagram');
```

**返回：**
- `true`: 成功获取并显示
- `false`: 获取失败

### askToSend(username)

询问是否发送

```javascript
const action = await batchDM.askToSend('instagram');
```

**返回：**
- `'send'`: 发送
- `'skip'`: 跳过
- `'quit'`: 停止

### formatNumber(num)

格式化数字

```javascript
batchDM.formatNumber(1500)      // "1.5K"
batchDM.formatNumber(1500000)   // "1.5M"
batchDM.formatNumber(500)       // "500"
```

---

## 🎉 总结

### ✅ 功能特点

1. **智能显示** - 自动获取并格式化用户资料
2. **灵活控制** - 可以选择发送、跳过或停止
3. **友好界面** - 清晰美观的资料展示
4. **可选功能** - 可以开启或关闭
5. **容错处理** - 获取失败也能继续

### 🚀 立即使用

```bash
# 演示脚本（推荐）
node demo-smart-batch-dm.js

# 测试脚本
node test-smart-batch.js
```

### 📖 相关文档

- **SMART_BATCH_DM_GUIDE.md** - 完整使用指南
- **SMART_BATCH_SUMMARY.md** - 功能总结
- **USER_PROFILE_FEATURE.md** - 用户资料功能（本文件）

---

**🎊 现在您可以在群发时看到每个用户的完整资料了！**

